(function($){$.fn.jTree=function(options){$("body").append('<ul id="jTreeHelper" style="z-index:2000"></ul>');var opts=$.extend({},$.fn.jTree.defaults,options),cur=0,curOff=0,off=0,h=0,w=0,hover=0,str='<li class="jTreePlacement" style="background:'+opts.pBg+";border:"+opts.pBorder+";color:"+opts.pColor+";height:"+opts.pHeight+'"></li>',container=this;$(this).find("li").mousedown(function(e){if($("#jTreeHelper").is(":not(:animated)")&&e.button!=2){$("body").css("cursor","move");$("body").append(str);$(".jTreePlacement").hide();$(this).clone().appendTo("#jTreeHelper");cur=this;curOff=$(cur).offset();$(cur).hide();$("#jTreeHelper").css({position:"absolute",top:e.pageY+5,left:e.pageX+5,background:opts.hBg,opacity:opts.hOpacity}).hide();opts.showHelper&&$("#jTreeHelper").show();$("#jTreeHelper *").css({color:opts.hColor,background:opts.hBg});$(document).bind("selectstart",doNothing);$(container).find("li").bind("dblclick",doNothing);$(container).find("li").bind("mouseover",getInitial);$(container).bind("mousemove",sibOrChild);$(container).find("li").bind("mousemove",putPlacement);$(document).bind("mousemove",helperPosition)}return false});$(this).find("li").andSelf().mouseup(function(e){$("body").css("cursor","default");$(".jTreePlacement").is(":visible")&&$(cur).insertBefore(".jTreePlacement").show();$(cur).show();$(container).find("ul:empty").remove();$("#jTreeHelper").empty().hide();$(".jTreePlacement").remove();destroyBindings();return false});$(document).mouseup(function(e){$("body").css("cursor","default");if($("#jTreeHelper").is(":not(:empty)")){$("#jTreeHelper").animate({top:curOff.top,left:curOff.left},opts.snapBack,function(){$("#jTreeHelper").empty().hide();$(".jTreePlacement").remove();$(cur).show()});destroyBindings()}return false});var doNothing=function(){return false},destroyBindings=function(){$(document).unbind("selectstart",doNothing);$(container).find("li").unbind("dblclick",doNothing);$(container).find("li").unbind("mouseover",getInitial);$(container).find("li").unbind("mousemove",putPlacement);$(document).unbind("mousemove",helperPosition);$(container).unbind("mousemove",sibOrChild);return false},helperPosition=function(e){$("#jTreeHelper").css({top:e.pageY+5,left:e.pageX+5});$(".jTreePlacement").remove();return false},getInitial=function(e){off=$(this).offset();h=$(this).height();w=$(this).width();hover=this;return false},sibOrChild=function(e){$("#jTreeHelper").css({top:e.pageY+5,left:e.pageX+5});return false},putPlacement=function(e){$(cur).hide();$("#jTreeHelper").css({top:e.pageY+5,left:e.pageX+5});if(e.pageY>=off.top&&e.pageY<off.top+h/2-1){if(!$(this).prev().hasClass("jTreePlacement")){$(".jTreePlacement").remove();$(this).before(str)}}else if(e.pageY>off.top+h/2&&e.pageY<=off.top+h)if(e.pageX>off.left&&e.pageX<off.left+opts.childOff){if(!$(this).next().hasClass("jTreePlacement")){$(".jTreePlacement").remove();$(this).after(str)}}else if(e.pageX>off.left+opts.childOff){$(".jTreePlacement").remove();if($(this).find("ul").length==0)$(this).append("<ul>"+str+"</ul>");else $(this).find("ul").prepend(str)}$(".jTreePlacement").length>1&&$(".jTreePlacement:first-child").remove();return false},lockIn=function(e){$(".jTreePlacement").length==1&&$(cur).insertBefore(".jTreePlacement");$(cur).show();$("#jTreeHelper").empty().hide();$(".jTreePlacement").remove();return false}};$.fn.jTree.defaults={showHelper:true,hOpacity:.5,hBg:"#FCC",hColor:"#222",pBorder:"1px dashed #CCC",pBg:"#EEE",pColor:"#222",pHeight:"20px",childOff:20,snapBack:1e3}})(jQuery)